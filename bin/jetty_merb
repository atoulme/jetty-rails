#!/usr/bin/env jruby

# == Synopsis
#
# jetty_merb: jetty server for merb applications
#
# == Usage
#
# jetty_merb [OPTION] ... BASEDIR
#
# BASEDIR (optional): directory to be run (default: current).
#
# -h, --help::
#    show help
#
# --context-path PATH, -u PATH::
#    change the application context path (default: '/')
#
# --port PORT, -p PORT::
#    change server port (default: 4000)
#
# --environment ENV, -e ENV::
#    change rails environment (default: development)
#

require "java"
require "jetty_rails"
require 'getoptlong'

opts = GetoptLong.new(
    [ '--help', '-h', GetoptLong::NO_ARGUMENT ],
    [ '--context-path', '-u', GetoptLong::REQUIRED_ARGUMENT ],
    [ '--port', '-p', GetoptLong::REQUIRED_ARGUMENT ],
    [ '--environment', '-e', GetoptLong::REQUIRED_ARGUMENT ]
  )

config = {
  :base => Dir.pwd,
  :port => 4000,
  :adapter => :merb
}

opts.each do |opt, arg|
  case opt
    when '--help'
      RDoc::usage
    when '--context-path'
      config[:context_path] = arg
    when '--port'
      config[:port] = arg.to_i
    when '--environment'
      config[:environment] = arg
  end
end

config[:base] = ARGV.shift unless ARGV.empty?

runner = JettyRails::Runner.new(config)
runner.start
